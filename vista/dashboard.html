<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1 class="m-0"><i class="fas fa-chart-line"></i> Dashboard</h1>
      </div>
      <div class="col-sm-6">
        <ol class="breadcrumb float-sm-right">
          <li class="breadcrumb-item"><a href="#">Home</a></li>
          <li class="breadcrumb-item active">Dashboard</li>
        </ol>
      </div>
    </div>
  </div>
</div>

<div id="dashboard" class="content">
  <div class="container-fluid">
    
    <!-- Tarjetas de Estadísticas -->
    <div class="row">
      <div class="col-lg-3 col-6">
        <div class="small-box bg-info">
          <div class="inner">
            <h3>{{ formatearNumero(estadisticas.total_productos) }}</h3>
            <p>Productos Registrados</p>
          </div>
          <div class="icon">
            <i class="fas fa-boxes"></i>
          </div>
          <a href="?page=productos" class="small-box-footer">
            Ver más <i class="fas fa-arrow-circle-right"></i>
          </a>
        </div>
      </div>

      <div class="col-lg-3 col-6">
        <div class="small-box bg-success">
          <div class="inner">
            <h3>{{ formatearNumero(estadisticas.total_clientes) }}</h3>
            <p>Clientes Activos</p>
          </div>
          <div class="icon">
            <i class="fas fa-users"></i>
          </div>
          <a href="?page=clientes" class="small-box-footer">
            Ver más <i class="fas fa-arrow-circle-right"></i>
          </a>
        </div>
      </div>

      <div class="col-lg-3 col-6">
        <div class="small-box bg-warning">
          <div class="inner">
            <h3 style="color: white;">{{ formatearNumero(estadisticas.total_entradas) }}</h3>
            <p style="color: white;">Entradas Este Mes</p>
          </div>
          <div class="icon">
            <i class="fas fa-arrow-down"></i>
          </div>
          <a href="?page=entrada" class="small-box-footer">
            Ver más <i class="fas fa-arrow-circle-right"></i>
          </a>
        </div>
      </div>

      <div class="col-lg-3 col-6">
        <div class="small-box bg-danger">
          <div class="inner">
            <h3>{{ formatearNumero(estadisticas.total_salidas) }}</h3>
            <p>Salidas Este Mes</p>
          </div>
          <div class="icon">
            <i class="fas fa-arrow-up"></i>
          </div>
          <a href="?page=salida" class="small-box-footer">
            Ver más <i class="fas fa-arrow-circle-right"></i>
          </a>
        </div>
      </div>
    </div>

    <!-- Segunda fila de estadísticas -->
    <div class="row">
      <div class="col-lg-6 col-12">
        <div class="info-box bg-gradient-primary">
          <span class="info-box-icon"><i class="fas fa-warehouse"></i></span>
          <div class="info-box-content">
            <span class="info-box-text">Total Unidades en Inventario</span>
            <h3 class="info-box-number">{{ formatearNumero(estadisticas.valor_inventario) }}</h3>
            <span class="progress-description">
              Todas las bodegas
            </span>
          </div>
        </div>
      </div>

      <div class="col-lg-6 col-12">
        <div class="info-box bg-gradient-danger">
          <span class="info-box-icon"><i class="fas fa-exclamation-triangle"></i></span>
          <div class="info-box-content">
            <span class="info-box-text">Productos con Stock Bajo</span>
            <h3 class="info-box-number">{{ formatearNumero(estadisticas.stock_bajo) }}</h3>
            <span class="progress-description">
              Menos de 50 unidades
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Gráficas -->
    <div class="row">
      <!-- Gráfica de Entradas vs Salidas -->
      <div class="col-lg-6">
        <div class="card card-primary">
          <div class="card-header">
            <h3 class="card-title"><i class="fas fa-chart-line"></i> Entradas vs Salidas</h3>
            <div class="card-tools">
              <button type="button" class="btn btn-tool" data-card-widget="collapse">
                <i class="fas fa-minus"></i>
              </button>
            </div>
          </div>
          <div class="card-body">
            <div style="height: 300px;">
              <canvas id="chartEntradasSalidas"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Gráfica de Movimientos por Categoría -->
      <div class="col-lg-6">
        <div class="card card-success">
          <div class="card-header">
            <h3 class="card-title"><i class="fas fa-chart-pie"></i> Movimientos por Categoría</h3>
            <div class="card-tools">
              <button type="button" class="btn btn-tool" data-card-widget="collapse">
                <i class="fas fa-minus"></i>
              </button>
            </div>
          </div>
          <div class="card-body">
            <div style="height: 300px;">
              <canvas id="chartMovimientosCategorias"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Segunda fila de gráficas -->
    <div class="row">
      <!-- Productos Más Vendidos -->
      <div class="col-lg-6">
        <div class="card card-warning">
          <div class="card-header">
            <h3 class="card-title"><i class="fas fa-star"></i> Productos Más Vendidos</h3>
            <div class="card-tools">
              <button type="button" class="btn btn-tool" data-card-widget="collapse">
                <i class="fas fa-minus"></i>
              </button>
            </div>
          </div>
          <div class="card-body">
            <div style="height: 300px;">
              <canvas id="chartProductosMasVendidos"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Clientes Más Activos -->
      <div class="col-lg-6">
        <div class="card card-info">
          <div class="card-header">
            <h3 class="card-title"><i class="fas fa-users"></i> Clientes Más Activos</h3>
            <div class="card-tools">
              <button type="button" class="btn btn-tool" data-card-widget="collapse">
                <i class="fas fa-minus"></i>
              </button>
            </div>
          </div>
          <div class="card-body">
            <div style="height: 300px;">
              <canvas id="chartClientesActivos"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tablas de Datos -->
    <div class="row">
      <!-- Inventario Bajo -->
      <div class="col-lg-6">
        <div class="card card-danger">
          <div class="card-header">
            <h3 class="card-title"><i class="fas fa-exclamation-circle"></i> Productos con Stock Bajo</h3>
            <div class="card-tools">
              <button type="button" class="btn btn-tool" data-card-widget="collapse">
                <i class="fas fa-minus"></i>
              </button>
            </div>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive" style="max-height: 400px;">
              <table class="table table-striped table-sm">
                <thead>
                  <tr>
                    <th>Producto</th>
                    <th>EAN</th>
                    <th>Bodega</th>
                    <th class="text-center">Cantidad</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="producto in inventarioBajo" :key="producto.ean">
                    <td>{{ producto.nombre.substring(0, 30) }}...</td>
                    <td><span class="badge badge-secondary">{{ producto.ean }}</span></td>
                    <td>{{ producto.bodega }}</td>
                    <td class="text-center">
                      <span class="badge badge-danger">{{ producto.cantidad }}</span>
                    </td>
                  </tr>
                  <tr v-if="inventarioBajo.length === 0">
                    <td colspan="4" class="text-center text-muted">
                      <i class="fas fa-check-circle"></i> No hay productos con stock bajo
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="card-footer">
            <a href="?page=inventario" class="btn btn-sm btn-danger">
              <i class="fas fa-list"></i> Ver Todo el Inventario
            </a>
          </div>
        </div>
      </div>

      <!-- Últimas Transacciones -->
      <div class="col-lg-6">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fas fa-history"></i> Últimas Transacciones</h3>
            <div class="card-tools">
              <button type="button" class="btn btn-tool" data-card-widget="collapse">
                <i class="fas fa-minus"></i>
              </button>
            </div>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive" style="max-height: 400px;">
              <table class="table table-striped table-sm">
                <thead>
                  <tr>
                    <th>Tipo</th>
                    <th>Referencia</th>
                    <th>Cliente</th>
                    <th>Fecha</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="trans in ultimasTransacciones" :key="trans.referencia">
                    <td>
                      <span :class="'badge badge-' + trans.color">
                        <i :class="trans.tipo === 'Entrada' ? 'fas fa-arrow-down' : 'fas fa-arrow-up'"></i>
                        {{ trans.tipo }}
                      </span>
                    </td>
                    <td>{{ trans.referencia }}</td>
                    <td>{{ trans.cliente.substring(0, 20) }}</td>
                    <td class="text-sm">{{ formatearFecha(trans.fecha) }}</td>
                  </tr>
                  <tr v-if="ultimasTransacciones.length === 0">
                    <td colspan="4" class="text-center text-muted">
                      <i class="fas fa-inbox"></i> No hay transacciones recientes
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="card-footer">
            <div class="row">
              <div class="col-6">
                <a href="?page=entrada" class="btn btn-sm btn-success">
                  <i class="fas fa-arrow-down"></i> Ver Entradas
                </a>
              </div>
              <div class="col-6 text-right">
                <a href="?page=salida" class="btn btn-sm btn-danger">
                  <i class="fas fa-arrow-up"></i> Ver Salidas
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div v-if="loading" class="overlay">
      <i class="fas fa-3x fa-sync-alt fa-spin"></i>
    </div>

  </div>
</div>

<style>
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  color: white;
}

.table-responsive {
  overflow-y: auto;
}

.table-responsive::-webkit-scrollbar {
  width: 8px;
}

.table-responsive::-webkit-scrollbar-track {
  background: #f1f1f1;
}

.table-responsive::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 4px;
}

.table-responsive::-webkit-scrollbar-thumb:hover {
  background: #555;
}
</style>